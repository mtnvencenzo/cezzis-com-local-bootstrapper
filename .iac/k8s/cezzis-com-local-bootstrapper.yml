apiVersion: batch/v1
kind: Job
metadata:
  name: cezzis-com-local-bootstrapper
  namespace: cezzis
  annotations:
    # Replace=true tells ArgoCD to delete and recreate the Job on each sync
    # (Jobs are immutable, so patching would fail)
    argocd.argoproj.io/sync-options: Replace=true
  labels:
    app: cezzis-com-local-bootstrapper
    app.kubernetes.io/part-of: cezzis
    app.kubernetes.io/managed-by: argocd
spec:
  template:
    metadata:
      labels:
        app: cezzis-com-local-bootstrapper
        app.kubernetes.io/part-of: cezzis
        app.kubernetes.io/managed-by: argocd
    spec:
      imagePullSecrets:
        - name: acr-pull-secret
      containers:
        - name: cezzis-com-local-bootstrapper
          image: acrveceusgloshared001.azurecr.io/cezziscombootstrapper
          envFrom:
            - configMapRef:
                name: cezzis-com-local-bootstrapper-config
            - secretRef:
                name: cezzis-com-local-bootstrapper-secrets
          volumeMounts:
            - name: rabbitmq-config
              mountPath: /config/rabbitmq.json
              subPath: rabbitmq.json
              readOnly: true
      volumes:
        - name: rabbitmq-config
          configMap:
            name: rabbitmq-config
      restartPolicy: Never